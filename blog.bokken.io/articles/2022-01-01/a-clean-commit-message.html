<!DOCTYPE html>
<html lang="ja">
  <head
    prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#"
  >
    <meta charset="utf-8" />
    <title>きれいなコミットメッセージとは | blog.bokken.io</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="description"
      content="最近、大きなコードベースを触る機会が増えてきれいなコミットメッセージについて考える事が増えた。
きれいなコミットメッセージの定義は様々あると思うが、筆者は下記がきれいなコミットメッセージに必要なことだと考えている。"
    />
    <meta name="author" content="bokken" />
    <link rel="shortcut icon" href=/assets/img/favicon.ico />
    <link rel="author" href="humans.txt" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@bokken_" />
    <meta name="twitter:creator" content="@bokken_" />
    <meta
      name="twitter:image"
      content="https://bokken.io/assets/img/icon.png"
    />
    <!-- ogp -->
    <meta
      property="og:url"
      content="https://blog.bokken.io/articles/2022-01-01/a-clean-commit-message.html"
    />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="きれいなコミットメッセージとは" />
    <meta
      property="og:description"
      content="最近、大きなコードベースを触る機会が増えてきれいなコミットメッセージについて考える事が増えた。
きれいなコミットメッセージの定義は様々あると思うが、筆者は下記がきれいなコミットメッセージに必要なことだと考えている。"
    />
    <meta property="og:site_name" content="blog.bokken.io" />
    <meta property="og:image" content="https://bokken.io/assets/img/icon.png" />

    <!-- Google -->
    <!-- prettier-ignore -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-83287008-4"></script>
    <!-- prettier-ignore -->
    <script>
      window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-83287008-4');
    </script>

    <!-- Twitter -->
    <script
      async
      src="https://platform.twitter.com/widgets.js"
      charset="utf-8"
    ></script>
    <!-- prettier-ignore -->
    <script>
      !(function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } })(document, 'script', 'twitter-wjs');
    </script>

    <link rel=stylesheet type=text/css href=/assets/css/main.css>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/default.min.css"
    />
  </head>

  <body>
    <header>
      <a href="http://bokken.io">bokken.io</a>
      <nav>
        <ul>
          <li><a href="https://blog.bokken.io">Blog</a></li>
          <li><a href="https://x.bokken.io">Exp</a></li>
          <li><a href="https://blog.bokken.io/feeds/atom.xml">RSS</a></li>
        </ul>
      </nav>
    </header>

    <ul id="bread">
      <li><a href="https://bokken.io" bokken.io>bokken.io</a></li>
      <li><a href="https://blog.bokken.io">blog</a></li>
      <li>
        <a
          href="https://blog.bokken.io/articles/2022-01-01/a-clean-commit-message.html"
          >きれいなコミットメッセージとは</a
        >
      </li>
    </ul>

    <main>
      <article>
        <div id="blog-info">
          <dt>作成日</dt>
          <dd>2022-01-01</dd>
          <dt>更新日</dt>
          <dd>2022-01-01</dd>
          <dt>author</dt>
          <dd><a href="https://twitter.com/bokken_">@bokken_</a></dd>
          <dt>tag</dt>
          <dd>
            <img
              id="article-tag"
              src="https://blog.bokken.io/assets/img/tag.webp"
              height="20"
            />
            commit-message
          </dd>
        </div>
        <h1>
          <a
            name="きれいなコミットメッセージとは"
            href="#きれいなコミットメッセージとは"
            id="きれいなコミットメッセージとは"
          >
            きれいなコミットメッセージとは
          </a>
        </h1>
        <p>
          最近、大きなコードベースを触る機会が増えてきれいなコミットメッセージについて考える事が増えた。
          きれいなコミットメッセージの定義は様々あると思うが、筆者は下記がきれいなコミットメッセージに必要なことだと考えている。
        </p>
        <ol>
          <li>どこに対する変更かが分かる</li>
          <li>どんな変更かが分かる</li>
          <li>プロジェクト内で統一されている</li>
        </ol>
        <p>
          これに対して、私はcommit_type(module): message
          という形式でコミットメッセージを記載するのが分かりやすさと手間がちょうど良いのではないかと思っている。
        </p>
        <p>順番に説明をしていく。</p>
        <h2>
          <a
            name="どこに対する変更か"
            href="#どこに対する変更か"
            id="どこに対する変更か"
          >
            どこに対する変更か
          </a>
        </h2>
        <p>
          1
          つめについては、当たり前のことであると感じるかもしれないが、このうち特に
          &quot;どこ&quot;
          の部分がをわかりやすく書くのは難しいのではないかと思っていた。
        </p>
        <p>
          例えば Fix accuracy of retuened value from functionA
          というコミットメッセージを書いたとしよう。これはどんな変更なのかは分かる、とても普通のコミットメッセージだと思う。
        </p>
        <p>
          ただ、これが大規模なコードベースとなった場合、この functionA
          がどのモジュール（どこ）なのか、コミットメッセージだけでは判断がつかない。diff
          を見ればどこのモジュールの変更なのかは一目瞭然であるが、diff
          を見る手間が発生する(tig などを使えばある程度削減されるが)。
        </p>
        <p>
          気づかないうちにある部分が壊れていて原因となったコミットを探す際、1つ2つのコミットを遡るのであればこれでも良いが、大量のコミットがあるようなプロジェクトの場合、この手間は大きなコストになる。
        </p>
        <p>
          function A in module X
          というようにモジュールを書くようにするという方法もあるが、少し冗長になってしまうし、英文の最後まで読まなければ分からないという課題もある。
        </p>
        <p>
          そこで (module)
          という部分を追加することで、どのモジュールかがはっきりと分かる。こうすることで、あるモジュールが壊れていることに気づいたときに
          (module) で grep すれば、該当コミットが見つけやすい。ここで、module
          の粒度はチーム内で合意が取れている粒度で記載する。（そうでなければ結局自由に記載しているのと変わらない）
        </p>
        <p>
          このように記載することで、英文を書くのに比べて狙いが分かりやすくなると考える。
        </p>
        <h2>
          <a
            name="どんな変更かが分かる"
            href="#どんな変更かが分かる"
            id="どんな変更かが分かる"
          >
            どんな変更かが分かる
          </a>
        </h2>
        <p>
          次にどんな変更なのか内容が分かりやすく書くためにはどうするべきかについて述べる。
          まず、message
          の部分に、普段どおりのメッセージを記載しておけば、どんな変更なのかはある程度分かる。ただし、英文で記載されているので、どういう変更なのかは英文を読み解かなければ、機能追加なのか、バグフィックスなのかがすぐさま判断つかないことがある。
        </p>
        <p>
          そこで、commit_type を記載するようにする。この commit_type
          は、例えば下記のようにコミットの作業を大別したもので、チームの中で合意が取れているものにする。
        </p>
        <ul>
          <li>feat</li>
          <li>chore</li>
          <li>fix</li>
          <li>docs</li>
          <li>perf</li>
          <li>refactor</li>
          <li>style</li>
          <li>test</li>
        </ul>
        <p>こうすることで、どういった変更なのかがよりわかりやすくなる。</p>
        <p>
          加えて、可能であれば、ここにより長いコミットメッセージを 3
          行目以降に記載してもよいと思う。加えて、どの issue
          に紐付いているのかをコミットメッセージに記載するのも有効なように思う。
        </p>
        <p>具体的には下記のように。</p>
        <pre><code>commit_type(module): short message

long message.

issue: 123456</code></pre>
        <p>
          この long_message や issue を書くかどうかは、手間や、タスクが issue
          で管理されているかどうかなどに応じて追加してもよいように思う。
        </p>
        <h2>
          <a
            name="プロジェクト内で統一されている"
            href="#プロジェクト内で統一されている"
            id="プロジェクト内で統一されている"
          >
            プロジェクト内で統一されている
          </a>
        </h2>
        <p>
          先程までのテンプレートに沿うことでプロジェクト内である程度の統一することができる。
          コミットメッセージが統一されていることで、コミットメッセージを読む側からすると、コミットメッセージごとに読み方の切り替えをする必要性が少なくなり負担が少なくなる。
        </p>
        <h2>
          <a name="終わりに" href="#終わりに" id="終わりに"> 終わりに </a>
        </h2>
        <p>
          このエントリではコミットメッセージをきれいに書くために下記が必要であるという考えを述べた。
        </p>
        <ol>
          <li>どこに対する変更かが分かる</li>
          <li>どんな変更かが分かる</li>
          <li>プロジェクト内で統一されている</li>
        </ol>
        <p>これに対して、具体的に私はcommit_type(module): message か</p>
        <pre><code>commit_type(module): message

long message.

issue: 123456</code></pre>
        <p>というコミットメッセージを書くのが良いのではという考えを述べた。</p>
        <p>
          この考え方に至ったのは最近で、現在運用しているところなのでまた追加で気づいた事があれば、
          このエントリをアップデートしたいと思う。
        </p>
        <p>
          もしもよりよいコミットメッセージの書き方、コミットの考え方などがあれば、
          <a href="https://twitter.com/bokken_">@bokken_</a>
          まで教えていただけると嬉しい。
        </p>
      </article>

      <!-- prettier-ignore -->
      <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a>
      <!-- prettier-ignore -->
      <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script>

      <!-- prettier-ignore -->
      <a href="https://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-label" data-hatena-bookmark-lang="ja" data-hatena-bookmark-height="20" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/v4/public/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
      <!-- prettier-ignore -->
      <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async" ></script>

      <div>
        Subscribe via <a href="https://blog.bokken.io/feeds/atom.xml">RSS</a>
      </div>

      <div class="article-pager">
        <div class="prev-article">
          <a
            href="https://blog.bokken.io/articles/2021-12-30/lookback-2021.html"
          >
            前の記事へ
          </a>
        </div>

        <div class="blog-top">
          <a href="https://blog.bokken.io">TOP</a>
        </div>
      </div>
    </main>

    <footer>
      Copyright &copy; 2018 bokken. All Rights Reserved.
      <a href="https://bokken.io/privacy-policy.html">Privacy Policy</a>
    </footer>
  </body>
</html>

