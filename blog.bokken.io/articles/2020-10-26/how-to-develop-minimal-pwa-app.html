<!DOCTYPE html>
<html lang="ja">
  <head
    prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#"
  >
    <meta charset="utf-8" />
    <title>Progressive Web App 化する最低限の設定 | blog.bokken.io</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="description"
      content="Progressive Web App (PWA) の勉強がてら https://blog.bokken.io を PWA 化した。本記事では、その内容をまとめておきたい。記事ではインストールを可能にするのみで、コンテンツのキャッシュや push 通知などは行わない。それは blog で対応した際に改めて記事にする。まず簡単に PWA とは何かをおさらいしておく。要素技術的には下記が関係してくる。"
    />
    <meta name="author" content="bokken" />
    <link rel="shortcut icon" href=/assets/img/favicon.ico />
    <link rel="author" href="humans.txt" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@bokken_" />
    <meta name="twitter:creator" content="@bokken_" />
    <meta
      name="twitter:image"
      content="https://bokken.io/assets/img/icon.png"
    />
    <!-- ogp -->
    <meta
      property="og:url"
      content="https://blog.bokken.io/articles/2020-10-26/how-to-develop-minimal-pwa-app.html"
    />
    <meta property="og:type" content="article" />
    <meta
      property="og:title"
      content="Progressive Web App 化する最低限の設定"
    />
    <meta
      property="og:description"
      content="Progressive Web App (PWA) の勉強がてら https://blog.bokken.io を PWA 化した。本記事では、その内容をまとめておきたい。記事ではインストールを可能にするのみで、コンテンツのキャッシュや push 通知などは行わない。それは blog で対応した際に改めて記事にする。まず簡単に PWA とは何かをおさらいしておく。要素技術的には下記が関係してくる。"
    />
    <meta property="og:site_name" content="blog.bokken.io" />
    <meta property="og:image" content="https://bokken.io/assets/img/icon.png" />

    <!-- Google -->
    <!-- prettier-ignore -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-83287008-4"></script>
    <!-- prettier-ignore -->
    <script>
      window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-83287008-4');
    </script>

    <!-- Twitter -->
    <script
      async
      src="https://platform.twitter.com/widgets.js"
      charset="utf-8"
    ></script>
    <!-- prettier-ignore -->
    <script>
      !(function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } })(document, 'script', 'twitter-wjs');
    </script>

    <link rel=stylesheet type=text/css href=/assets/css/main.css>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/default.min.css"
    />
  </head>

  <body>
    <header>
      <a href="http://bokken.io">bokken.io</a>
      <nav>
        <ul>
          <li><a href="https://blog.bokken.io">Blog</a></li>
          <li><a href="https://x.bokken.io">Exp</a></li>
          <li><a href="https://blog.bokken.io/feeds/atom.xml">RSS</a></li>
        </ul>
      </nav>
    </header>

    <ul id="bread">
      <li><a href="https://bokken.io" bokken.io>bokken.io</a></li>
      <li><a href="https://blog.bokken.io">blog</a></li>
      <li>
        <a
          href="https://blog.bokken.io/articles/2020-10-26/how-to-develop-minimal-pwa-app.html"
          >Progressive Web App 化する最低限の設定</a
        >
      </li>
    </ul>

    <main>
      <article>
        <div id="blog-info">
          <dt>作成日</dt>
          <dd>2020-10-26</dd>
          <dt>更新日</dt>
          <dd>2020-10-26</dd>
          <dt>author</dt>
          <dd><a href="https://twitter.com/bokken_">@bokken_</a></dd>
          <dt>tag</dt>
          <dd>
            <img
              id="article-tag"
              src="https://blog.bokken.io/assets/img/tag.webp"
              height="20"
            />
            Web, PWA, App Manifest, Service Worker
          </dd>
        </div>
        <h1>
          <a
            name="Progressive Web App 化する最低限の設定"
            href="#Progressive Web App 化する最低限の設定"
            id="Progressive Web App 化する最低限の設定"
          >
            Progressive Web App 化する最低限の設定
          </a>
        </h1>
        <h2>
          <a name="概要" href="#概要" id="概要"> 概要 </a>
        </h2>
        <p id="e0uhecqnyPJz6ZVU6wWUbQ==" class="paragraph">
          Progressive Web App (PWA) の勉強がてら
          <code>https://blog.bokken.io</code> を PWA 化した。<a
            href="#e0uhecqnyPJz6ZVU6wWUbQ=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <blockquote class="twitter-tweet">
          <p lang="ja" dir="ltr">
            ブログの PWA 化できたのでインストールできるようになった
            <a href="https://t.co/O36JnpcPjc">pic.twitter.com/O36JnpcPjc</a>
          </p>
          &mdash; bokken✏ (@bokken_)
          <a
            href="https://twitter.com/bokken_/status/1320280517451804673?ref_src=twsrc%5Etfw"
            >October 25, 2020</a
          >
        </blockquote>

        <p id="ggV0ntTKo5StPVUuh2iUYQ==" class="paragraph">
          本記事では、その内容をまとめておきたい。<a
            href="#ggV0ntTKo5StPVUuh2iUYQ=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="F7rlMoiv6Jja3VWTlbEa8Q==" class="paragraph">
          記事ではインストールを可能にするのみで、コンテンツのキャッシュや push
          通知などは行わない。<a
            href="#F7rlMoiv6Jja3VWTlbEa8Q=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="u3BWsdUznbNm4/9UR+i7BA==" class="paragraph">
          それは blog で対応した際に改めて記事にする。<a
            href="#u3BWsdUznbNm4/9UR+i7BA=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <details>
          <summary>## 目次 (click で開く)</summary>
          <h2>
            <a name="目次" href="#目次" id="目次"> 目次 </a>
          </h2>
          <ol>
            <li><a target="_blank" href="#概要" rel="noopener">概要</a></li>
            <li><a target="_blank" href="#目次" rel="noopener">目次</a></li>
            <li><a target="_blank" href="#デモ" rel="noopener">デモ</a></li>
            <li>
              <a
                target="_blank"
                href="#Progressive-Web-App-PWAとは"
                rel="noopener"
                >Progressive Web App (PWA)とは</a
              >
              <ol>
                <li>
                  <a
                    target="_blank"
                    href="#PWA-に必要なファイル概要"
                    rel="noopener"
                    >PWA に必要なファイル概要</a
                  >
                </li>
              </ol>
            </li>
            <li>
              <a target="_blank" href="#Web-App-Manifest" rel="noopener"
                >Web App Manifest</a
              >
            </li>
            <li>
              <a target="_blank" href="#Service-Workers" rel="noopener"
                >Service Workers</a
              >
            </li>
            <li>
              <a target="_blank" href="#必要となるファイル" rel="noopener"
                >必要となるファイル</a
              >
              <ol>
                <li>
                  <a target="_blank" href="#scope-について" rel="noopener"
                    >scope について</a
                  >
                </li>
              </ol>
            </li>
            <li>
              <a target="_blank" href="#おわりに" rel="noopener">おわりに</a>
            </li>
            <li>
              <a target="_blank" href="#参考リンク" rel="noopener"
                >参考リンク</a
              >
            </li>
          </ol>
        </details>
        <h2>
          <a name="デモ" href="#デモ" id="デモ"> デモ </a>
        </h2>
        <p id="UMsZ2Pf1MUHS0uS46Gru9w==" class="paragraph">
          本 blog も PWA 化しているが、別途<a
            target="_blank"
            href="https://x.bokken.io/example-pwa/index.html"
            rel="noopener"
            >デモ</a
          >
          を用意している。<a
            href="#UMsZ2Pf1MUHS0uS46Gru9w=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <h2>
          <a
            name="Progressive Web App (PWA)とは"
            href="#Progressive Web App (PWA)とは"
            id="Progressive Web App (PWA)とは"
          >
            Progressive Web App (PWA)とは
          </a>
        </h2>
        <p id="Xm0JFhiC6THW7tUoDTcLDQ==" class="paragraph">
          まず簡単に PWA とは何かをおさらいしておく。<a
            href="#Xm0JFhiC6THW7tUoDTcLDQ=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="7BmTAzW1DX+RnNKJ+I6X+w==" class="paragraph">
          PWA とはネイティブアプリケーションのようなユーザ体験を Web
          の技術で実現できる技術である。<a
            href="#7BmTAzW1DX+RnNKJ+I6X+w=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="Zoe9A+NGV9cOr+6WXc4f6w==" class="paragraph">
          クロスプラットフォームで提供されているブラウザ上でネイティブライクに動くアプリケーションが提供できれば、少ないコストでユーザ体験を向上させることが期待できる技術である。<a
            href="#Zoe9A+NGV9cOr+6WXc4f6w=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="GTvYoTiLZapuwii3h8LsAA==" class="paragraph">
          要素技術的には下記が関係してくる。<a
            href="#GTvYoTiLZapuwii3h8LsAA=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <ul>
          <li>
            <a
              target="_blank"
              href="https://www.w3.org/TR/appmanifest/"
              rel="noopener"
              >Web App Manifest</a
            >
          </li>
          <li>
            <a
              target="_blank"
              href="https://www.w3.org/TR/service-workers/"
              rel="noopener"
              >Service Workers 1</a
            >
          </li>
        </ul>
        <p id="MD6Ou9hFdt6xDGAt5zP9fg==" class="paragraph">
          もう一つ App Shell という概念も紹介されることが多い。<a
            href="#MD6Ou9hFdt6xDGAt5zP9fg=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="2W0YAjOS3DasneCdWKwD0g==" class="paragraph">
          App Shell は PWA
          を実現するときのアーキテクチャの一つであって、最低限必要な技術要素ではない。<a
            href="#2W0YAjOS3DasneCdWKwD0g=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="V5BdC40ymyU7/5c7P5canQ==" class="paragraph">
          Google の App Shell モデルの記事には下記のようにある。<a
            href="#V5BdC40ymyU7/5c7P5canQ=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <blockquote>
          <p id="v5nZIZCbFWZPBLvyHxDHSQ==" class="paragraph">
            アプリケーション シェル（App Shell）アーキテクチャは、ネイティブ
            アプリのように瞬時に、そして確実にユーザーの画面に読み込める
            Progressive Web App を構築する方法の 1 つです。<a
              href="#v5nZIZCbFWZPBLvyHxDHSQ=="
              class="paragraph-anchor"
              >¶</a
            >
          </p>
          <p id="fpsSAEIo14QthEd/GAGPvw==" class="paragraph">
            --
            <a
              target="_blank"
              href="https://developers.google.com/web/fundamentals/architecture/app-shell"
              rel="noopener"
              >App Shell モデル  |  Web  |  Google Developers</a
            ><a href="#fpsSAEIo14QthEd/GAGPvw==" class="paragraph-anchor">¶</a>
          </p>
        </blockquote>
        <p id="bMniuVvmTcWpHQu+ZRwRsw==" class="paragraph">
          なので、本記事では簡単に Web App Manifest と、Service Worker
          について紹介した上で、PWA 化するときの設定を紹介する。<a
            href="#bMniuVvmTcWpHQu+ZRwRsw=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <h3>
          <a
            name="PWA に必要なファイル概要"
            href="#PWA に必要なファイル概要"
            id="PWA に必要なファイル概要"
          >
            PWA に必要なファイル概要
          </a>
        </h3>
        <p id="Pg5fTucRs5BimGDrjkOFoA==" class="paragraph">
          ひとまずこれらから必要になるファイルは下記である。<a
            href="#Pg5fTucRs5BimGDrjkOFoA=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <ol>
          <li>icon ファイル</li>
          <li>Manifest フイル(manifest.json)</li>
          <li>
            Service Worker を登録するための js ファイル (html に書いても良い)
          </li>
          <li>上記 1, 2 を読み込む html ファイル</li>
          <li>Service Worker のファイル</li>
        </ol>
        <h2>
          <a
            name="Web App Manifest"
            href="#Web App Manifest"
            id="Web App Manifest"
          >
            Web App Manifest
          </a>
        </h2>
        <p id="/qO6Mtk2+oc0p9HrL5Th4A==" class="paragraph">
          Web App Manifest とは下記にあるように Web アプリケーションのメタデータ
          (名前、アイコン、リンクなど)を表すファイルである。<a
            href="#/qO6Mtk2+oc0p9HrL5Th4A=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <blockquote>
          <p id="meu5UY4P4tHhxyeGbptAxQ==" class="paragraph">
            centralized place to put metadata associated with a web application.
            This metadata includes, but is not limited to, the web
            application&#39;s name, links to icons, as well as the preferred URL
            to open when a user launches the web application.<a
              href="#meu5UY4P4tHhxyeGbptAxQ=="
              class="paragraph-anchor"
              >¶</a
            >
          </p>
          <p id="LmkmdyRLB8f2Zki7FySDtw==" class="paragraph">
            --
            <a
              target="_blank"
              href="https://w3c.github.io/manifest/"
              rel="noopener"
              >Web App Manifest</a
            ><a href="#LmkmdyRLB8f2Zki7FySDtw==" class="paragraph-anchor">¶</a>
          </p>
        </blockquote>
        <p id="hjkaTTKGFIUrl4xt6JXm2g==" class="paragraph">
          例えば下記のようなデータである。<a
            href="#hjkaTTKGFIUrl4xt6JXm2g=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <pre><code class="language-json">{
  <span class="hljs-attr">"short_name"</span>: <span class="hljs-string">"bokken-blog"</span>,
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"blog.bokken.io"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A web tech blog"</span>,
  <span class="hljs-attr">"icons"</span>: [
    {
      <span class="hljs-attr">"src"</span>: <span class="hljs-string">"/icon.svg"</span>,
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"image/svg+xml"</span>,
      <span class="hljs-attr">"sizes"</span>: <span class="hljs-string">"144x144"</span>
    }
  ],
  <span class="hljs-attr">"start_url"</span>: <span class="hljs-string">"/?source=pwa"</span>,
  <span class="hljs-attr">"background_color"</span>: <span class="hljs-string">"#6c6c6c"</span>,
  <span class="hljs-attr">"display"</span>: <span class="hljs-string">"standalone"</span>,
  <span class="hljs-attr">"scope"</span>: <span class="hljs-string">"/"</span>,
  <span class="hljs-attr">"theme_color"</span>: <span class="hljs-string">"#00a3af"</span>
}
</code></pre>
        <p id="a5QEA0mL317xiCJ/3CHMMw==" class="paragraph">
          このファイル名で指定する icon ファイル (icon.svg)
          は別途用意しておく必要がある。(ない場合は動かない)<a
            href="#a5QEA0mL317xiCJ/3CHMMw=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="uHz4ZfHYesAkdidCrAN7/Q==" class="paragraph">
          この Web App Manifest ファイルの名前は
          <code>manifest.webmanifest</code> でもよいし、<code
            >manifest.json</code
          >
          でもよい。あるいは他のファイル名などであればサーバ側で
          <code>ContentType: application/manifest+json</code>
          で返せばブラウザが解釈できる。<a
            href="#uHz4ZfHYesAkdidCrAN7/Q=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="2hQaHGyoFhZ0j1RwsvTXzw==" class="paragraph">
          そして、html ファイルから下記のように読み込むことでブラウザに Web
          ページのメタ情報を伝えることができる。<a
            href="#2hQaHGyoFhZ0j1RwsvTXzw=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"manifest"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/manifest.json"</span> /&gt;</span>
</code></pre>
        <h2>
          <a
            name="Service Workers"
            href="#Service Workers"
            id="Service Workers"
          >
            Service Workers
          </a>
        </h2>
        <p id="nH3YBOHf4wvWnA171aEYUw==" class="paragraph">
          Service Worker というのは
          <a
            target="_blank"
            href="https://www.w3.org/TR/workers/"
            rel="noopener"
            >Web Worker</a
          >
          の一種である。 Service Worker はブラウザの JavaScript
          からインストールされてバックグラウンドで動作する。<a
            href="#nH3YBOHf4wvWnA171aEYUw=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="gyP1zpLjSABEjj8OXxEYgg==" class="paragraph">
          この Service Worker
          はプッシュ通知やプロキシ、バックグラウンドでの同期などで利用されているのを見かける技術である。<a
            href="#gyP1zpLjSABEjj8OXxEYgg=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="7vOSNIpC+01DGVXLicMGwQ==" class="paragraph">
          PWA 化するために Service Worker の JS ファイルとしては下記のような
          Event Listener を登録しておく。(下記はログを表示するだけである)<a
            href="#7vOSNIpC+01DGVXLicMGwQ=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <pre><code class="language-js">self.addEventListener(<span class="hljs-string">'install'</span>, (event) =&gt; {
  <span class="hljs-built_in">console</span>.info(<span class="hljs-string">'installed'</span>);
});

self.addEventListener(<span class="hljs-string">'activate'</span>, (event) =&gt; {
  <span class="hljs-built_in">console</span>.info(<span class="hljs-string">'service worker activated'</span>);
});

self.addEventListener(<span class="hljs-string">'fetch'</span>, (event) =&gt; {
  <span class="hljs-built_in">console</span>.info(<span class="hljs-string">'fetch event occurred'</span>);
});
</code></pre>
        <p id="rT2KsjCY8qOrqarx7e7aYg==" class="paragraph">
          中でも fetch に対する <code>addEventListener</code> がないと「Page
          does not work offline」 と表示されてインストールができない。最低限
          <code>fetch</code> に対する addEventListener を追加する必要がある。<a
            href="#rT2KsjCY8qOrqarx7e7aYg=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="t8OeZIH0OA8WDfFn90ZHhw==" class="paragraph">
          このファイルを <code>sw.js</code> として保存しておき、下記のように
          html のページから <code>sw.js</code> を ブラウザに Service Worker
          として登録できる。<a
            href="#t8OeZIH0OA8WDfFn90ZHhw=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <pre><code class="language-js"><span class="hljs-keyword">if</span> (<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) {
  <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'load'</span>, () =&gt; {
    navigator.serviceWorker
      .register(<span class="hljs-string">'/sw.js'</span>, {<span class="hljs-attr">scope</span>: <span class="hljs-string">'/'</span>})
      .then(<span class="hljs-function">(<span class="hljs-params">registration</span>) =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(
          <span class="hljs-string">'Successfully registered service worker with scope: '</span>,
          registration.scope
        );
      })
      .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Failed to register service worker with err: '</span>, err);
      });
  });
}
</code></pre>
        <h2>
          <a
            name="必要となるファイル"
            href="#必要となるファイル"
            id="必要となるファイル"
          >
            必要となるファイル
          </a>
        </h2>
        <p id="tGkhv5IgIVuak6UrjhKNUg==" class="paragraph">
          上記の説明を合わせると下記のようなファイル群が必要である。<a
            href="#tGkhv5IgIVuak6UrjhKNUg=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <ol>
          <li>
            <p id="7flyrSDLCGnDuxT0O6+eew==" class="paragraph">
              icon ファイル<a
                href="#7flyrSDLCGnDuxT0O6+eew=="
                class="paragraph-anchor"
                >¶</a
              >
            </p>
          </li>
          <li>
            <p id="bqg64ec6hqoOnO/RbNwWWw==" class="paragraph">
              Web App Manifest ファイル<a
                href="#bqg64ec6hqoOnO/RbNwWWw=="
                class="paragraph-anchor"
                >¶</a
              >
            </p>
            <pre><code class="language-json">{
  <span class="hljs-attr">"short_name"</span>: <span class="hljs-string">"blog.bokken.io"</span>,
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"bokken.io"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A web tech blog"</span>,
  <span class="hljs-attr">"icons"</span>: [
    {
      <span class="hljs-attr">"src"</span>: <span class="hljs-string">"icon.svg"</span>,
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"image/svg+xml"</span>,
      <span class="hljs-attr">"sizes"</span>: <span class="hljs-string">"144x144"</span>
    }
  ],
  <span class="hljs-attr">"start_url"</span>: <span class="hljs-string">"/?source=pwa"</span>,
  <span class="hljs-attr">"background_color"</span>: <span class="hljs-string">"#6c6c6c"</span>,
  <span class="hljs-attr">"display"</span>: <span class="hljs-string">"standalone"</span>,
  <span class="hljs-attr">"scope"</span>: <span class="hljs-string">"/"</span>,
  <span class="hljs-attr">"theme_color"</span>: <span class="hljs-string">"#00a3af"</span>
}
</code></pre>
          </li>
          <li>
            <p id="Om2QA4niNpQE9VE+bM0QTQ==" class="paragraph">
              html ファイルと Service Worker を登録するための JavaScript<a
                href="#Om2QA4niNpQE9VE+bM0QTQ=="
                class="paragraph-anchor"
                >¶</a
              >
            </p>
            <pre><code class="language-html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"manifest"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"manifest.json"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      <span class="hljs-keyword">if</span> (<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) {
        <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'load'</span>, () =&gt; {
          navigator.serviceWorker
            .register(<span class="hljs-string">'/sw.js'</span>, {<span class="hljs-attr">scope</span>: <span class="hljs-string">'/'</span>})
            .then(<span class="hljs-function">(<span class="hljs-params">registration</span>) =&gt;</span> {
              <span class="hljs-built_in">console</span>.log(
                <span class="hljs-string">'Successfully registered service worker with scope: '</span>,
                registration.scope
              );
            })
            .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
              <span class="hljs-built_in">console</span>.error(
                <span class="hljs-string">'Failed to register service worker with err: '</span>,
                err
              );
            });
        });
      }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    HELLO WORLD
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
          </li>
          <li>
            <p id="+vDb1w88JYYlsbZMMOIRNQ==" class="paragraph">
              Service Worker のファイル<a
                href="#+vDb1w88JYYlsbZMMOIRNQ=="
                class="paragraph-anchor"
                >¶</a
              >
            </p>
            <pre><code class="language-js">self.addEventListener(<span class="hljs-string">'install'</span>, (event) =&gt; {
  <span class="hljs-built_in">console</span>.info(<span class="hljs-string">'installed'</span>);
});

self.addEventListener(<span class="hljs-string">'activate'</span>, (event) =&gt; {
  <span class="hljs-built_in">console</span>.info(<span class="hljs-string">'service worker activated'</span>);
});

self.addEventListener(<span class="hljs-string">'fetch'</span>, (event) =&gt; {
  <span class="hljs-built_in">console</span>.info(<span class="hljs-string">'fetch event occurred'</span>);
});
</code></pre>
          </li>
        </ol>
        <p id="hvPY6KyLJAeMy7S6MCC2zw==" class="paragraph">
          これらのファイルを配信するだけで、PWA 化することができる。<a
            href="#hvPY6KyLJAeMy7S6MCC2zw=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <h3>
          <a name="scope について" href="#scope について" id="scope について">
            scope について
          </a>
        </h3>
        <p id="IYejviWSORWnGPyU+kIbLQ==" class="paragraph">
          <code>manifest.json</code> や Service Worker 登録のタイミングで
          <code>scope</code>
          を指定するが、これは少しハマる可能性のあるポイントである。<a
            href="#IYejviWSORWnGPyU+kIbLQ=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="z4nCFzTzlIFU0HxewsS+Zg==" class="paragraph">
          要は PWA
          化したアプリケーションがどこのページを提供するのかを表現する。この
          scope 内を Application
          化するとイメージできる。ここで指定した範囲のリクエストなどは fetch
          イベント発生時にフックされて、オフラインのキャッシュを返したり、独自の処理を挟むことができる。<a
            href="#z4nCFzTzlIFU0HxewsS+Zg=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="gdRZ3qpW52Eh9YFodaKIiQ==" class="paragraph">
          scope については Chrome の開発者である
          <a target="_blank" href="https://twitter.com/nhiroki_" rel="noopener"
            >@nhiroki_</a
          >
          さんの
          <a
            target="_blank"
            href="https://qiita.com/nhiroki/items/eb16b802101153352bba"
            rel="noopener"
            >ServiceWorker のスコープとページコントロールについて - Qiita</a
          >
          の記事がとてもわかり易いので参照していただきたい。<a
            href="#gdRZ3qpW52Eh9YFodaKIiQ=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <h2>
          <a name="おわりに" href="#おわりに" id="おわりに"> おわりに </a>
        </h2>
        <p id="QE9oUii73IOVxWHlnuVFXQ==" class="paragraph">
          Progressive Web App (PWA) 化に必要最低限の内容を紹介した。<a
            href="#QE9oUii73IOVxWHlnuVFXQ=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="7AWu3A3jiRToCIZQUYriDA==" class="paragraph">
          これ以外にも
          <code>sw.js</code>
          を改良することで、インストール時やアクティベート時に処理を挟んだり、コンテンツのキャッシュをしておき
          fetch
          時にプロキシ処理を挟むことでオフラインでアクセスできるようになったりする。<a
            href="#7AWu3A3jiRToCIZQUYriDA=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="5gkr5JlSWunESwWBYHVH9g==" class="paragraph">
          本ブログも機会があれが PWA
          化し、そこで得た知見についてはまた記事にしたいと思う。<a
            href="#5gkr5JlSWunESwWBYHVH9g=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <p id="Z6pPPg1IiZWhIcg0FKm9pw==" class="paragraph">
          もしも不足している内容や間違っている内容があれば
          <a
            target="_blank"
            href="https://github.com/negibokken/bokken.io/issues"
            rel="noopener"
            >issue</a
          >
          か Twitter アカウント
          <a target="_blank" href="https://twitter.com/bokken_" rel="noopener"
            >@bokken_</a
          >
          まで連絡をいただけると嬉しい。<a
            href="#Z6pPPg1IiZWhIcg0FKm9pw=="
            class="paragraph-anchor"
            >¶</a
          >
        </p>
        <h2>
          <a name="参考リンク" href="#参考リンク" id="参考リンク">
            参考リンク
          </a>
        </h2>
        <ul>
          <li>
            <a
              target="_blank"
              href="https://web.dev/what-are-pwas/"
              rel="noopener"
              >What are Progressive Web Apps?</a
            >
          </li>
          <li>
            <a
              target="_blank"
              href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Offline_Service_workers"
              rel="noopener"
              >Making PWAs work offline with Service workers - Progressive web
              apps (PWAs) | MDN</a
            >
          </li>
          <li>
            <a
              target="_blank"
              href="https://developers.google.com/web/ilt/pwa/introduction-to-service-worker"
              rel="noopener"
              >Introduction to Service Worker  |  Web  |  Google Developers</a
            >
          </li>
          <li>
            <a
              target="_blank"
              href="https://web.dev/pwa-checklist/"
              rel="noopener"
              >What makes a good Progressive Web App?</a
            >
          </li>
          <li>
            <a
              target="_blank"
              href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps"
              rel="noopener"
              >Progressive web apps (PWAs) | MDN</a
            >
          </li>
          <li>
            <a
              target="_blank"
              href="https://www.w3.org/TR/service-workers/"
              rel="noopener"
              >Service Workers 1</a
            >
          </li>
          <li>
            <a
              target="_blank"
              href="https://developers.google.com/web/fundamentals/primers/service-workers?hl=en"
              rel="noopener"
              >Service Workers: an Introduction  |  Web Fundamentals</a
            >
            <a
              target="_blank"
              href="https://developers.google.com/web/fundamentals/primers/service-workers?hl=ja"
              rel="noopener"
              >Service Worker の紹介  |  Web Fundamentals  |  Google
              Developers</a
            >
          </li>
          <li>
            <a
              target="_blank"
              href="https://qiita.com/nhiroki/items/eb16b802101153352bba"
              rel="noopener"
              >ServiceWorker のスコープとページコントロールについて - Qiita</a
            >
          </li>
        </ul>
      </article>

      <!-- prettier-ignore -->
      <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a>
      <!-- prettier-ignore -->
      <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script>

      <!-- prettier-ignore -->
      <a href="https://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-label" data-hatena-bookmark-lang="ja" data-hatena-bookmark-height="20" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/v4/public/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
      <!-- prettier-ignore -->
      <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async" ></script>

      <div>
        Subscribe via <a href="https://blog.bokken.io/feeds/atom.xml">RSS</a>
      </div>

      <div class="article-pager">
        <div class="prev-article">
          <a
            href="https://blog.bokken.io/articles/2020-10-05/privacy-policy-note.html"
          >
            前の記事へ
          </a>
        </div>

        <div class="blog-top">
          <a href="https://blog.bokken.io">TOP</a>
        </div>

        <div class="next-article">
          <a
            href="https://blog.bokken.io/articles/2021-02-28/how-to-build-chromium.html"
          >
            次の記事へ
          </a>
        </div>
      </div>
    </main>

    <footer>
      Copyright &copy; 2018 bokken. All Rights Reserved.
      <a href="https://bokken.io/privacy-policy.html">Privacy Policy</a>
    </footer>
  </body>
</html>

